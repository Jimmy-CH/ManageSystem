[uwsgi]
# 监听内网 IP 和端口（使用 uWSGI 协议，非 HTTP！）
http            = 0.0.0.0:8000
# socket = :8000（或 socket = 0.0.0.0:8000）
# 风险：如果服务器有公网 IP 且防火墙未限制，互联网任何人都能连接！
# socket          = :8000

# 项目路径
home            = /opt/ManageSystem/server/venv
chdir           = /opt/ManageSystem/server/
wsgi-file       = /opt/ManageSystem/server/wsgi.py

# 日志
daemonize = /opt/ManageSystem/server/logs/uwsgi.log
disable-logging = True      ;仅记录错误，访问日志由 Nginx 或应用层处理

# 进程
master = True
workers = 12
threads = 3
enable-threads = True
lazy-apps = true              ; 每个 worker 独立加载 Django，避免 fork 问题

# 关键防护
reload-on-rss       = 300    ; MB！当 RSS > 300MB 时立即重启 worker
max-requests        = 1500   ; 每处理 1500 请求重启一次
max-requests-delta  = 300    ; 随机偏移 0~300


# 超时
harakiri            = 120    ; 请求超时 120 秒
http-timeout        = 300
reload-mercy        = 10



# 清理
vacuum             = True
reaper             = True
pidfile            = /opt/ManageSystem/server/uwsgi.pid

# 安全
buffer-size        = 65536
post-buffering     = 8192
