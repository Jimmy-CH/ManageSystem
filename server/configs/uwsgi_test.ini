# uwsgi_test.ini - Django 项目 uWSGI 配置（HTTP 模式）
[uwsgi]

# Django 项目路径
chdir           = /opt/ManageSystem/server/

# Django 的 WSGI 模块
module          = server.wsgi:application

# 虚拟环境路径
home            = /opt/ManageSystem/server/venv

# 改为监听 HTTP 端口（关键修改）
http            = :8000
# 或指定 IP 和端口（如只允许本地）
# http            = 127.0.0.1:8000

# 注释或删除原来的 socket 配置（避免冲突）
# socket          = /tmp/uwsgi_server.sock
# chmod-socket    = 666

# 进程和线程配置
processes       = 8
threads         = 4
enable-threads  = true

# 主进程管理
master          = true
pidfile         = /opt/ManageSystem/server/uwsgi_server.pid

# 自动化
vacuum          = true
die-on-term     = true
max-requests    = 5000
max-requests-delta = 100

# 日志配置
logto           = /opt/ManageSystem/server/logs/uwsgi.log
log-maxsize     = 50000000
disable-logging = false

# 超时设置
harakiri        = 30
http-timeout    = 30
# socket-timeout  # 在 http 模式下不适用

# 缓存和性能
buffer-size     = 65536
post-buffering  = 8192

# 安全：可选，运行后降权（推荐生产使用）
uid             = www-data
gid             = www-data

# 其他可选：限制请求体大小
limit-post      = 10485760  # 10MB