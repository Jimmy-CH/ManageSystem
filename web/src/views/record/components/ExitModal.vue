<!-- src/components/ExitModal.vue -->
<template>
  <el-dialog
    title="Âõ≠ÈÄö‰∫ë‰∏≠ÂøÉËøõÂá∫ÁôªËÆ∞"
    :visible.sync="dialogVisible"
    width="800px"
    @close="resetForm"
  >
    <!-- ‰∫∫Âëò‰ø°ÊÅØ -->
    <div class="info-section">
      <h4>‰∫∫Âëò‰ø°ÊÅØ</h4>
      <!-- üëá ÂåÖË£πÂè™ËØª‰ø°ÊÅØÁöÑ el-form -->
      <el-form :model="form" label-width="100px" size="small">
        <el-row :gutter="20">
          <el-col :span="12">
            <el-form-item label="ÂßìÂêç" prop="name">
              <el-input v-model="form.name" readonly />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="‰∫∫ÂëòÁ±ªÂûã" prop="type">
              <el-select v-model="form.type" disabled>
                <el-option label="Â§ñÈÉ®‰∫∫Âëò" value="external" />
                <el-option label="ÂÜÖÈÉ®‰∫∫Âëò" value="internal" />
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="Âçï‰Ωç" prop="unit">
              <el-input v-model="form.unit" readonly />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="ÈÉ®Èó®" prop="department">
              <el-input v-model="form.department" readonly />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="ËØÅ‰ª∂Á±ªÂûã" prop="idType">
              <el-select v-model="form.idType" disabled>
                <el-option label="Ë∫´‰ªΩËØÅ" value="idcard" />
                <el-option label="Êä§ÁÖß" value="passport" />
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="ËØÅ‰ª∂Âè∑Á†Å" prop="idNo">
              <el-input v-model="form.idNo" readonly />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="ÁîµËØù" prop="phone">
              <el-input v-model="form.phone" readonly />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="ËøõÂá∫Êó∂Èó¥" prop="timeRange">
              <el-date-picker
                v-model="form.timeRange"
                type="datetimerange"
                range-separator="Ëá≥"
                start-placeholder="ÂºÄÂßãÊó∂Èó¥"
                end-placeholder="ÁªìÊùüÊó∂Èó¥"
                value-format="yyyy-MM-dd HH:mm"
                format="yyyy-MM-dd HH:mm"
                style="width: 100%;"
              />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="ËøõÂÖ•ÂéüÂõ†" prop="reason">
              <el-input v-model="form.reason" readonly />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="Êê∫Â∏¶Áâ©ÂìÅ" prop="items">
              <el-input v-model="form.items" readonly />
            </el-form-item>
          </el-col>
          <el-col :span="24">
            <el-form-item label="ÂÖ≥ËÅîOA" prop="oa">
              <el-input v-model="form.oa" readonly />
            </el-form-item>
          </el-col>
        </el-row>
      </el-form>
    </div>

    <!-- Á¶ªÂú∫ÁôªËÆ∞Ë°®Âçï -->
    <div class="exit-form">
      <el-tabs v-model="activeTab" type="card" style="margin-top: 15px;">
        <el-tab-pane label="Á¶ªÂú∫ÁôªËÆ∞" name="exit">
          <!-- üëá ÂÖ≥ÈîÆÔºöTab ÂÜÖÂøÖÈ°ªÊúâËá™Â∑±ÁöÑ el-form -->
          <el-form
            ref="exitForm"
            :model="form"
            label-width="100px"
            size="small"
          >
            <el-form-item label="* Èó®Á¶ÅÂç°‰ø°ÊÅØ" prop="exitCardInfo">
              <el-select v-model="form.exitCardInfo" placeholder="ËØ∑ÈÄâÊã©" style="width: 100%;">
                <el-option label="Êó†ÈúÄÂèëÂç°" value="none" />
                <el-option label="Â∑≤ÂèëÂç°" value="issued" />
              </el-select>
            </el-form-item>

            <el-form-item label="* ËØÅ‰ª∂Ë¥®Êäº" prop="exitIdDeposit">
              <el-select v-model="form.exitIdDeposit" placeholder="ËØ∑ÈÄâÊã©" style="width: 100%;">
                <el-option label="Êú™Ë¥®Êäº" value="not_deposited" />
                <el-option label="Â∑≤Ë¥®Êäº" value="deposited" />
              </el-select>
            </el-form-item>

            <el-form-item label="* Á¶ªÂú∫ÊÉÖÂÜµ" prop="exitStatus">
              <el-radio-group v-model="form.exitStatus">
                <el-radio label="Ê≠£Â∏∏">Ê≠£Â∏∏</el-radio>
                <el-radio label="ÂºÇÂ∏∏">ÂºÇÂ∏∏</el-radio>
              </el-radio-group>
            </el-form-item>

            <el-form-item label="* Â§áÊ≥®" prop="remark">
              <el-input
                v-model="form.remark"
                type="textarea"
                :rows="3"
                placeholder="ËØ∑ËæìÂÖ•Â§áÊ≥®"
                style="width: 100%;"
              />
            </el-form-item>
          </el-form>
        </el-tab-pane>
      </el-tabs>
    </div>

    <div slot="footer" class="dialog-footer">
      <el-button @click="dialogVisible = false">ÂèñÊ∂à</el-button>
      <el-button type="primary" @click="submitForm">Á°ÆÂÆö</el-button>
    </div>
  </el-dialog>
</template>

<script>
export default {
  name: 'ExitModal',
  props: {
    visible: Boolean,
    personnel: {
      type: Object,
      default: () => ({})
    }
  },
  data() {
    return {
      activeTab: 'exit',
      form: {
        name: '',
        type: 'external',
        unit: '',
        department: '',
        idType: 'idcard',
        idNo: '',
        phone: '',
        timeRange: [],
        reason: '',
        items: '',
        oa: '',
        exitCardInfo: 'none',
        exitIdDeposit: 'not_deposited',
        exitStatus: 'Ê≠£Â∏∏',
        remark: ''
      }
    }
  },
  computed: {
    dialogVisible: {
      get() {
        return this.visible
      },
      set(val) {
        this.$emit('update:visible', val)
      }
    }
  },
  watch: {
    personnel: {
      handler(newVal) {
        if (newVal && newVal.name) {
          this.form.name = newVal.name || ''
          this.form.type = newVal.type || 'external'
          this.form.unit = newVal.unit || ''
          this.form.department = newVal.department || ''
          this.form.idType = newVal.idType || 'idcard'
          this.form.idNo = newVal.idNo || ''
          this.form.phone = newVal.phone || ''
          this.form.reason = newVal.reason || ''
          this.form.items = newVal.items || ''
          this.form.oa = newVal.oa || ''
        }
      },
      immediate: true
    }
  },
  methods: {
    resetForm() {
      this.form.exitCardInfo = 'none'
      this.form.exitIdDeposit = 'not_deposited'
      this.form.exitStatus = 'Ê≠£Â∏∏'
      this.form.remark = ''
      this.form.timeRange = []
    },
    submitForm() {
      const payload = {
        ...this.form,
        status: 'exited'
      }
      this.$emit('submit', payload)
      this.dialogVisible = false
    }
  }
}
</script>

<style scoped>
.info-section {
  background: #f5f7fa;
  padding: 15px;
  border-radius: 4px;
  margin-bottom: 15px;
}

.info-section h4 {
  margin-top: 0;
  color: #333;
  font-size: 14px;
  border-bottom: 1px solid #eee;
  padding-bottom: 8px;
}

.exit-form {
  background: white;
  padding: 15px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.dialog-footer {
  text-align: right;
  padding-top: 15px;
}
</style>
